#!/usr/bin/env bash
set -euo pipefail

FLAKE_PATH="${HOME}/.config/nixos"
HOST="${1:-wsl}"

if [[ ! -f "${FLAKE_PATH}/flake.nix" ]]; then
  echo "flake not found: ${FLAKE_PATH}/flake.nix" >&2
  exit 1
fi

echo "Applying NixOS config: ${FLAKE_PATH}#${HOST}"
sudo nixos-rebuild switch --flake "${FLAKE_PATH}#${HOST}"
